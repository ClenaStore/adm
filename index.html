<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéüÔ∏è Painel da Rifa Solid√°ria</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Orbitron:wght@600&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#05091b;--card:#0f172a;--line:#1f2f49;
  --ink:#eaf2ff;--muted:#94a3b8;
  --accent:#00e5ff;--ok:#16a34a;--warn:#f59e0b;
  --bad:#ef4444;--info:#3b82f6;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Inter',system-ui}
body{
  background:radial-gradient(circle at top,#0b132c,#020510 80%);
  color:var(--ink);
  min-height:100vh;
  padding:12px;
}
header{text-align:center;margin-bottom:15px;}
header h1{
  font-family:'Orbitron',sans-serif;
  color:var(--accent);
  text-shadow:0 0 10px var(--accent);
  font-size:1.6rem;margin-bottom:10px;
}
.refresh{
  background:linear-gradient(90deg,#00e5ff,#9333ea);
  color:#fff;padding:8px 18px;
  border:none;border-radius:8px;font-weight:600;
  box-shadow:0 0 10px rgba(0,229,255,.5);
}
.refresh:hover{filter:brightness(1.1)}
.msg{text-align:center;margin:10px 0;font-weight:600;}
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
  gap:10px;margin-bottom:10px;
}
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:10px;
  padding:8px;
  text-align:center;
  box-shadow:0 0 10px rgba(0,0,0,.3);
}
.card h3{font-size:0.9rem;color:var(--muted);margin-bottom:3px}
.card span{font-weight:700;font-size:1.2rem}

.table{
  width:100%;
  border-collapse:collapse;
  background:var(--card);
  border:1px solid var(--line);
  border-radius:10px;
  overflow:hidden;
  box-shadow:0 0 10px rgba(0,0,0,.3);
}
th,td{
  padding:8px;
  border-bottom:1px solid var(--line);
  font-size:0.9rem;text-align:left;
}
th{background:#13213b;color:#cdd9f0}
tr:hover{background:#1b2945}
.status{
  padding:4px 8px;border-radius:6px;
  font-weight:700;font-size:0.8rem;
  display:inline-block;
}
.RESERVADO{background:#312d16;color:var(--warn)}
.PAGO{background:#102d1d;color:var(--ok)}
.CANCELADO{background:#3b1c1c;color:var(--bad)}
.ENTREGUE{background:#132d40;color:var(--info)}
select{
  background:#101a30;color:#fff;
  border:1px solid var(--line);
  padding:6px;border-radius:6px;
  width:100%;
  font-size:0.85rem;
}
footer{text-align:center;color:var(--muted);margin-top:20px;font-size:0.8rem}

/* Responsividade */
@media (max-width:768px){
  th:nth-child(1),td:nth-child(1),
  th:nth-child(3),td:nth-child(3),
  th:nth-child(5),td:nth-child(5),
  th:nth-child(6),td:nth-child(6),
  th:nth-child(7),td:nth-child(7){
    display:none;
  }
  th,td{font-size:0.85rem}
  header h1{font-size:1.3rem}
}
</style>
</head>
<body>
<header>
  <h1>üéüÔ∏è Painel da Rifa Solid√°ria</h1>
  <button class="refresh" onclick="load()">üîÑ Atualizar</button>
</header>

<div id="msg" class="msg"></div>

<section id="cards" class="cards"></section>

<div style="overflow-x:auto;">
<table class="table">
  <thead>
    <tr>
      <th>#</th><th>Nome</th><th>Telefone</th><th>Email</th><th>N√∫meros</th>
      <th>Qtd</th><th>Total (R$)</th><th>Data/Hora</th><th>Status</th><th>Mudar</th>
    </tr>
  </thead>
  <tbody id="body">
    <tr><td colspan="10" style="text-align:center;">‚è≥ Carregando...</td></tr>
  </tbody>
</table>
</div>

<footer>¬© 2025 Rifa Solid√°ria ‚Ä¢ Painel Mobile</footer>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyYSizHVpqN_tB-p-ufIpTj2HsE3443pCDnw4PtiydXfWp6XCZdshvNpLpvy4A01IJ2ug/exec";
let DATA = [];

function toast(msg, error=false){
  const el=document.getElementById("msg");
  el.style.color=error?"#ff6b81":"#7af59a";
  el.textContent=msg;
  if(msg)setTimeout(()=>el.textContent="",2500);
}

function jsonp(url){
  return new Promise((resolve,reject)=>{
    const cb="cb_"+Math.random().toString(36).slice(2);
    window[cb]=(payload)=>{resolve(payload);cleanup();};
    const s=document.createElement("script");
    s.src=url+(url.includes("?")?"&":"?")+"callback="+cb;
    s.onerror=()=>{reject(new Error("Erro JSONP"));cleanup();};
    document.body.appendChild(s);
    function cleanup(){try{delete window[cb]}catch{};s.remove();}
  });
}

async function load(){
  document.getElementById("body").innerHTML="<tr><td colspan='10' style='text-align:center;'>‚è≥ Carregando...</td></tr>";
  try{
    const dados=await jsonp(`${SCRIPT_URL}?action=list`);
    if(!Array.isArray(dados)) throw new Error("Formato inv√°lido");
    DATA=dados;
    renderCards(dados);
    renderTable(dados);
    toast("‚úÖ Dados atualizados");
  }catch(e){
    toast(e.message,true);
    document.getElementById("body").innerHTML="<tr><td colspan='10' style='text-align:center;'>‚ùå Erro ao carregar</td></tr>";
  }
}

function renderCards(rows){
  const total=rows.length;
  const pagos=rows.filter(r=>r.status==="PAGO").length;
  const reserv=rows.filter(r=>r.status==="RESERVADO").length;
  const cancel=rows.filter(r=>r.status==="CANCELADO").length;
  const entreg=rows.filter(r=>r.status==="ENTREGUE").length;
  document.getElementById("cards").innerHTML=`
    <div class="card"><h3>Total</h3><span style="color:var(--accent)">${total}</span></div>
    <div class="card"><h3>Pagos</h3><span style="color:var(--ok)">${pagos}</span></div>
    <div class="card"><h3>Reservados</h3><span style="color:var(--warn)">${reserv}</span></div>
    <div class="card"><h3>Cancelados</h3><span style="color:var(--bad)">${cancel}</span></div>
    <div class="card"><h3>Entregues</h3><span style="color:var(--info)">${entreg}</span></div>
  `;
}

function renderTable(rows){
  const tbody=document.getElementById("body");
  if(!rows.length){tbody.innerHTML="<tr><td colspan='10'>Nenhum registro</td></tr>";return;}
  tbody.innerHTML=rows.map(r=>{
    const sClass=r.status?` ${r.status}`:"";
    return `<tr id="r${r.rowNumber}">
      <td>${r.rowNumber}</td>
      <td>${esc(r.nome)}</td>
      <td>${esc(r.telefone)}</td>
      <td>${esc(r.email)}</td>
      <td>${esc(r.numeros)}</td>
      <td>${esc(r.qtd)}</td>
      <td>${esc(r.total)}</td>
      <td>${esc(r.dataHora)}</td>
      <td><span class="status${sClass}">${esc(r.status)}</span></td>
      <td>
        <select id="sel-${r.rowNumber}" onchange="update(${r.rowNumber}, this.value)">
          ${opt("RESERVADO",r.status)}
          ${opt("PAGO",r.status)}
          ${opt("CANCELADO",r.status)}
          ${opt("ENTREGUE",r.status)}
        </select>
      </td>
    </tr>`;
  }).join("");
}

function opt(v,cur){return `<option value="${v}" ${v===cur?"selected":""}>${v}</option>`;}
function esc(s){return String(s||"").replace(/[&<>"]/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[m]));}

async function update(row,status){
  const elRow=document.getElementById(`r${row}`);
  try{
    const res=await jsonp(`${SCRIPT_URL}?action=update&row=${row}&status=${encodeURIComponent(status)}`);
    if(res.ok){
      const statusEl=elRow.querySelector(".status");
      statusEl.className="status "+status;
      statusEl.textContent=status;
      toast("‚úÖ Status atualizado");
    } else {
      toast("‚ùå Falha: "+(res.error||"Erro"),true);
    }
  }catch(e){toast(e.message,true);}
}

load();
</script>
</body>
</html>
